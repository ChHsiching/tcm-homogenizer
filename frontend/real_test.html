<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>真实功能测试</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <!-- 登录界面 -->
    <div id="login-container" class="login-container">
        <div class="login-box">
            <h2>中药多组分均化分析客户端</h2>
            <div id="first-run-message" class="first-run-message" style="display: none;">
                <p>首次启动，请创建管理员账号</p>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">用户名</label>
                    <input type="text" id="username" name="username" value="admin" required>
                </div>
                <div class="form-group">
                    <label for="password">密码</label>
                    <input type="password" id="password" name="password" value="admin123" required>
                </div>
                <div class="form-group">
                    <button type="submit" id="login-btn">登录</button>
                </div>
            </form>
            <div id="login-error" class="error-message" style="display: none;"></div>
        </div>
    </div>

    <!-- 主应用界面 -->
    <div id="main-container" class="main-container" style="display: none;">
        <!-- 顶部导航栏 -->
        <header class="header">
            <div class="header-left">
                <h1>中药多组分均化分析客户端</h1>
            </div>
            <div class="header-right">
                <span id="user-info" class="user-info"></span>
                <button id="logout-btn" class="btn-secondary">退出登录</button>
            </div>
        </header>

        <!-- 导航菜单 -->
        <nav class="nav-menu">
            <button class="nav-btn active" data-tab="home">首页</button>
            <button class="nav-btn" data-tab="regression">符号回归</button>
            <button class="nav-btn" data-tab="monte-carlo">蒙特卡罗分析</button>
            <button class="nav-btn admin-only" data-tab="data-management">数据管理</button>
            <button class="nav-btn admin-only" data-tab="user-management">用户管理</button>
            <button class="nav-btn" data-tab="settings">设置</button>
        </nav>

        <!-- 主要内容区域 -->
        <main class="main-content">
            <!-- 首页 -->
            <div id="home" class="tab-content active">
                <h2>欢迎使用中药多组分均化分析客户端</h2>
                <div class="welcome-content">
                    <p>本系统提供中药多组分配比分析功能，包括：</p>
                    <ul>
                        <li><strong>符号回归分析</strong>：通过遗传算法发现数据中的数学关系</li>
                        <li><strong>蒙特卡罗分析</strong>：模拟不同配比组合的药效表现</li>
                        <li><strong>数据管理</strong>：上传、管理和导出分析数据</li>
                        <li><strong>用户管理</strong>：管理系统用户和权限</li>
                    </ul>
                    <div class="status-info">
                        <p><strong>后端状态</strong>：<span id="connection-status">检查中...</span></p>
                        <p><strong>当前用户</strong>：<span id="current-user">未登录</span></p>
                        <p><strong>用户角色</strong>：<span id="user-role">未知</span></p>
                    </div>
                </div>
            </div>

            <!-- 用户管理 -->
            <div id="user-management" class="tab-content">
                <h2>用户管理</h2>
                <div class="user-section">
                    <div class="user-actions">
                        <h3>用户操作</h3>
                        <button id="add-user-btn" class="btn-primary">添加用户</button>
                        <button id="refresh-users-btn" class="btn-secondary">刷新列表</button>
                    </div>
                    <div class="user-list">
                        <h3>用户列表</h3>
                        <div id="users-table" class="data-table">
                            <p>加载中...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- 状态栏 -->
        <footer class="status-bar">
            <div class="status-left">
                <span id="connection-status-footer">后端服务：检查中...</span>
            </div>
            <div class="status-right">
                <span id="current-time">2025-08-03 20:45:00</span>
            </div>
        </footer>
    </div>

    <!-- 加载遮罩 -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="spinner"></div>
            <p id="loading-text">正在处理...</p>
        </div>
    </div>

    <!-- 通知容器 -->
    <div id="notification-container" class="notification-container"></div>

    <!-- 模态框 -->
    <div id="modal-overlay" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">标题</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- 模态框内容 -->
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="modal-cancel">取消</button>
                <button class="btn-primary" id="modal-confirm">确认</button>
            </div>
        </div>
    </div>

    <script src="scripts/auth.js"></script>
    <script src="scripts/renderer.js"></script>
    
    <script>
        // 额外的调试信息
        console.log('🔧 真实测试页面加载完成');
        
        // 监听页面加载完成
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔧 DOM加载完成');
            
            // 检查认证管理器
            if (typeof authManager !== 'undefined') {
                console.log('✅ 认证管理器已加载');
            } else {
                console.error('❌ 认证管理器未加载');
            }
            
            // 检查渲染器
            if (typeof switchTab !== 'undefined') {
                console.log('✅ 渲染器已加载');
            } else {
                console.error('❌ 渲染器未加载');
            }
        });
        
        // 监听认证状态变化
        const originalUpdateUserInfo = authManager.updateUserInfo;
        authManager.updateUserInfo = function() {
            console.log('🔍 用户信息更新:', this.currentUser);
            originalUpdateUserInfo.call(this);
        };
        
        // 监听导航可见性变化
        const originalUpdateNavigationVisibility = authManager.updateNavigationVisibility;
        authManager.updateNavigationVisibility = function() {
            console.log('🔍 导航可见性更新');
            originalUpdateNavigationVisibility.call(this);
        };
    </script>
</body>
</html> 