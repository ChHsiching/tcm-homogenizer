# Windows独立运行版本说明

## 概述

我们已经成功创建了中药多组分均化分析客户端的Windows独立运行版本。这个版本设计为真正的"双击即用"程序，符合Electron应用程序的初衷，用户无需手动安装Python或Node.js依赖。

## 打包方案

### 方案特点
- **真正的便携式设计**：解压即可使用，无需安装
- **智能环境检测**：自动检测系统Python和Node.js
- **优雅的用户体验**：提供隐藏控制台的启动方式
- **完整的安装选项**：支持便携运行和系统安装两种模式

### 生成的文件结构
```
dist/
├── backend/              # Python后端文件
│   ├── api/              # API接口模块
│   ├── algorithms/       # 算法模块
│   ├── utils/            # 工具模块
│   ├── main.py           # 主程序（打包版本）
│   └── requirements.txt  # Python依赖列表
├── frontend/             # Electron前端文件
│   ├── main.js           # 主进程
│   ├── index.html        # 主界面
│   ├── scripts/          # 渲染进程脚本
│   ├── styles/           # 样式文件
│   ├── assets/           # 静态资源
│   ├── node_modules/     # Node.js依赖（已安装）
│   └── package.json      # 前端配置
├── 启动程序.bat          # 主启动脚本（显示控制台）
├── 启动程序.vbs          # 隐藏启动脚本（推荐）
├── 安装到系统.bat        # 系统安装脚本
├── 卸载程序.bat          # 系统卸载脚本
├── 测试后端.bat          # 后端测试脚本
└── 使用说明.txt          # 详细使用说明
```

## 使用方法

### 方式一：便携运行（推荐）

1. **解压文件**：将压缩包解压到任意目录
2. **启动应用**：
   - 双击 `启动程序.vbs`（推荐，无控制台窗口）
   - 或双击 `启动程序.bat`（显示控制台，便于调试）

### 方式二：安装到系统

1. **解压文件**：将压缩包解压到任意目录
2. **运行安装**：双击 `安装到系统.bat`
3. **启动应用**：从桌面或开始菜单启动

## 技术实现

### 智能环境检测
启动脚本会自动检测系统环境：
- **Python检测**：检查系统Python，如果未找到会提示安装
- **Node.js检测**：检查系统Node.js，如果未找到会提示安装
- **依赖安装**：首次运行自动安装Python依赖

### 进程管理
- **后端服务**：自动启动Python Flask后端服务
- **前端应用**：启动Electron前端界面
- **优雅关闭**：应用关闭时自动清理后端进程

### 错误处理
- **环境检查**：详细的错误提示和解决建议
- **依赖安装**：自动处理依赖安装失败的情况
- **进程清理**：确保应用关闭时清理所有相关进程

## 系统要求

### 必需软件
- **Windows 10/11 (x64)**
- **Python 3.10+**（程序会自动检测，未安装会提示）
- **Node.js**（程序会自动检测，未安装会提示）

### 硬件要求
- **内存**：至少2GB
- **磁盘空间**：至少1GB
- **架构**：x64

## 用户体验优化

### 启动方式
1. **VBS启动**（推荐）：
   - 双击 `启动程序.vbs`
   - 无控制台窗口，更符合桌面应用体验
   - 适合普通用户

2. **BAT启动**（调试）：
   - 双击 `启动程序.bat`
   - 显示控制台窗口，便于查看日志
   - 适合开发者和高级用户

### 安装选项
1. **便携运行**：
   - 无需安装，解压即用
   - 适合临时使用或U盘携带

2. **系统安装**：
   - 安装到系统目录
   - 创建桌面和开始菜单快捷方式
   - 适合长期使用

## 故障排除

### 常见问题

#### 1. Python未找到
**现象**：启动时提示"未找到Python环境"
**解决**：
- 下载并安装Python 3.10+：https://www.python.org/downloads/
- 安装时勾选"Add Python to PATH"
- 重启命令提示符

#### 2. Node.js未找到
**现象**：启动时提示"未找到Node.js环境"
**解决**：
- 下载并安装Node.js：https://nodejs.org/
- 安装时选择"Add to PATH"
- 重启命令提示符

#### 3. 依赖安装失败
**现象**：提示"后端依赖安装失败"
**解决**：
- 检查网络连接
- 使用国内镜像：`pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/`
- 更新pip：`python -m pip install --upgrade pip`

#### 4. 端口被占用
**现象**：后端服务启动失败
**解决**：
- 检查端口5000是否被占用
- 关闭其他占用端口的程序
- 重启计算机

#### 5. 杀毒软件报警
**现象**：杀毒软件阻止程序运行
**解决**：
- 将程序目录添加到杀毒软件白名单
- 临时关闭实时保护
- 信任程序签名

### 日志查看
- **后端日志**：`%TEMP%\tcm-homogenizer\logs\`
- **前端日志**：在Electron开发者工具中查看

## 版本信息

- **版本**：M1 原型版本
- **构建日期**：2025-07-27
- **Python版本**：3.13.5
- **Node.js版本**：20.19.4
- **Electron版本**：37.2.4

## 开发说明

### 打包脚本
- `scripts/build-portable-windows.sh`：便携式打包脚本
- `scripts/build-standalone-windows.sh`：独立exe打包脚本
- `scripts/build-electron-windows.sh`：Electron安装程序打包脚本

### 关键文件
- `backend/main_packaged.py`：打包版本的主程序
- `backend/utils/logger.py`：支持打包环境的日志模块
- `启动程序.bat`：Windows启动脚本
- `启动程序.vbs`：隐藏启动脚本

### 技术栈
- **后端**：Python + Flask + 科学计算库
- **前端**：Electron + HTML/CSS/JavaScript
- **通信**：HTTP API + RESTful接口
- **打包**：PyInstaller + 批处理脚本

## 后续计划

### M2版本改进
- [ ] 集成真正的Windows exe打包
- [ ] 添加自动更新功能
- [ ] 优化启动速度
- [ ] 添加更多错误处理

### M3版本目标
- [ ] 完整的安装程序
- [ ] 自动依赖管理
- [ ] 系统集成优化
- [ ] 用户体验提升

---

**注意**：这是一个测试版本，主要用于验证基础功能和架构设计。生产环境使用前请进行充分测试。 