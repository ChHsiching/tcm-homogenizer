# 中药多组分均化分析客户端 - 开发指南

## 项目概述

本项目是一个基于 Electron + Python 的跨平台桌面应用，用于中药多组分均化分析。项目采用前后端分离架构，前端使用 Electron 构建用户界面，后端使用 Python 实现算法逻辑。

## 技术栈

### 前端
- **Electron**: 跨平台桌面应用框架
- **HTML/CSS/JavaScript**: 前端界面开发
- **Node.js**: JavaScript 运行时环境

### 后端
- **Python 3.10+**: 主要编程语言
- **Flask**: Web 框架
- **NumPy/SciPy**: 科学计算
- **Pandas**: 数据处理
- **PySR/gplearn**: 符号回归算法

## 项目结构

```
tcm-homogenizer/
├── frontend/              # Electron 前端项目
│   ├── main.js           # 主进程文件
│   ├── preload.js        # 预加载脚本
│   ├── index.html        # 主界面
│   ├── styles/           # 样式文件
│   ├── scripts/          # 渲染进程脚本
│   └── package.json      # 项目配置
├── backend/              # Python 后端项目
│   ├── main.py           # 应用入口
│   ├── api/              # API 接口
│   ├── algorithms/       # 算法实现
│   ├── utils/            # 工具模块
│   └── requirements.txt  # Python 依赖
├── docs/                 # 项目文档
├── scripts/              # 自动化脚本
└── README.md            # 项目说明
```

## 开发环境设置

### 前置要求
- Node.js 18.20.8+ (LTS/Hydrogen)
- Python 3.10+
- Git

### 快速开始

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd tcm-homogenizer
   ```

2. **设置开发环境**
   ```bash
   ./scripts/setup-dev.sh
   ```

3. **启动开发环境**
   ```bash
   ./scripts/start-dev.sh
   ```

## 开发规范

### Git 提交规范

本项目使用 **Conventional Commits** 规范和 **Gitmoji**：

- 🎉 `feat:` 新功能
- 🐛 `fix:` 修复bug
- 📝 `docs:` 文档更新
- 🎨 `style:` 代码格式调整
- ♻️ `refactor:` 代码重构
- ⚡ `perf:` 性能优化
- ✅ `test:` 测试相关
- 🔧 `chore:` 构建过程或辅助工具的变动

### 分支管理

- `main`: 主分支，存放稳定代码
- `develop`: 开发分支，用于日常开发
- `feature/*`: 功能分支
- `hotfix/*`: 紧急修复分支

### 代码风格

#### Python
- 使用 Black 进行代码格式化
- 遵循 PEP 8 规范
- 使用类型注解
- 编写详细的文档字符串

#### JavaScript
- 使用 ESLint 进行代码检查
- 遵循 Airbnb JavaScript 规范
- 使用 ES6+ 语法

## 开发流程

### 1. 功能开发

1. 从 `develop` 分支创建功能分支
   ```bash
   git checkout develop
   git pull origin develop
   git checkout -b feature/your-feature-name
   ```

2. 开发功能并提交
   ```bash
   git add .
   git commit -m "🎉 feat: 添加新功能描述"
   ```

3. 推送到远程分支
   ```bash
   git push origin feature/your-feature-name
   ```

4. 创建 Pull Request 到 `develop` 分支

### 2. 测试

- 运行单元测试
- 进行集成测试
- 手动测试功能

### 3. 代码审查

- 代码审查通过后合并到 `develop` 分支
- 定期将 `develop` 分支合并到 `main` 分支

## API 开发

### 后端 API 结构

```python
# 符号回归 API
POST /api/regression/analyze
GET /api/regression/models
GET /api/regression/models/<model_id>

# 蒙特卡洛采样分析 API
POST /api/monte-carlo-sampling/analyze
GET /api/monte-carlo-sampling/results/<analysis_id>

# 数据处理 API
POST /api/data/upload
POST /api/data/validate
POST /api/data/preview
```

### 添加新的 API 端点

1. 在 `backend/api/routes.py` 中定义路由
2. 在对应的算法模块中实现业务逻辑
3. 添加错误处理和日志记录
4. 编写单元测试

## 前端开发

### 界面结构

- 主界面 (`index.html`): 应用的主要界面
- 样式文件 (`styles/main.css`): 深色主题样式
- 脚本文件 (`scripts/renderer.js`): 界面交互逻辑

### 添加新功能

1. 在 HTML 中添加界面元素
2. 在 CSS 中添加样式
3. 在 JavaScript 中添加交互逻辑
4. 在主进程中添加必要的 IPC 通信

## 算法开发

### 符号回归算法

位置: `backend/algorithms/symbolic_regression.py`

主要功能:
- 数据预处理
- 符号回归模型训练
- 模型评估和保存
- 预测功能

### 蒙特卡洛采样分析算法

位置: `backend/algorithms/monte_carlo.py`

主要功能:
- 基于回归模型进行随机采样
- 计算最优配比区间
- 生成统计报告

## 测试

### 运行测试

```bash
# Python 测试
cd backend
python -m pytest

# 前端测试 (待实现)
cd frontend
npm test
```

### 测试覆盖率

```bash
# Python 测试覆盖率
cd backend
python -m pytest --cov=.
```

## 构建和部署

### 开发构建

```bash
# 前端构建
cd frontend
npm run build

# 后端构建
cd backend
python setup.py build
```

### 生产构建

```bash
# 使用自动化脚本
./scripts/build.sh
```

## 调试

### 前端调试

1. 启动开发模式
   ```bash
   cd frontend
   NODE_ENV=development npm start
   ```

2. 使用 Electron 开发者工具

### 后端调试

1. 启动 Flask 调试模式
   ```bash
   cd backend
   python main.py
   ```

2. 使用 Python 调试器
   ```python
   import pdb; pdb.set_trace()
   ```

## 常见问题

### 1. Electron 应用无法启动

- 检查 Node.js 版本
- 确认依赖安装完整
- 查看控制台错误信息

### 2. Python 后端启动失败

- 检查 Python 版本
- 确认虚拟环境激活
- 检查依赖安装

### 3. 前后端通信失败

- 检查端口配置
- 确认 CORS 设置
- 查看网络连接

## 贡献指南

1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

## 联系方式

如有问题或建议，请通过以下方式联系：

- GitHub Issues
- 项目讨论区
- 邮件联系

---

**注意**: 本开发指南会随着项目发展持续更新，请定期查看最新版本。 