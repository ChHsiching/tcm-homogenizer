# 中药多组分均化分析客户端 - 登录功能使用说明

## 功能概述

本系统已成功集成了完整的用户认证和权限管理系统，包括：

### 🔐 认证功能
- **首次启动检测**：系统首次启动时会检测是否已创建管理员账号
- **管理员创建**：首次启动时只需设置管理员密码即可创建管理员账号
- **用户登录**：支持用户名密码登录
- **会话管理**：自动维护用户登录状态
- **安全登出**：支持安全退出登录

### 👥 用户管理（仅管理员）
- **用户列表**：查看所有用户信息
- **创建用户**：添加新用户账号
- **编辑用户**：修改用户信息（开发中）
- **删除用户**：删除用户账号
- **权限控制**：区分管理员和普通用户权限

### 🎨 界面特性
- **深色主题**：保持原有的暗色UI风格
- **响应式设计**：适配不同屏幕尺寸
- **用户友好**：简洁直观的操作界面
- **权限显示**：根据用户角色显示不同功能

## 系统架构

### 后端API
```
/api/auth/
├── check-admin     # 检查管理员状态
├── create-admin    # 创建管理员账号
├── login          # 用户登录
├── logout         # 用户登出
├── check-auth     # 检查认证状态
└── users          # 用户管理（增删改查）
```

### 前端组件
- `auth.js` - 认证管理模块
- `renderer.js` - 主应用逻辑
- `main.css` - 深色主题样式

## 使用流程

### 1. 首次启动
1. 启动后端服务：`cd backend && source venv/bin/activate && python main.py`
2. 启动前端服务：`cd frontend && python -m http.server 3000`
3. 访问 `http://localhost:3000`
4. 系统会显示"首次启动，请创建管理员账号"
5. 输入管理员密码并创建账号

### 2. 日常使用
1. 使用管理员账号登录
2. 在"用户管理"页面创建普通用户账号
3. 普通用户登录后只能使用符号回归和蒙特卡罗分析功能
4. 管理员可以使用所有功能

### 3. 用户权限

#### 管理员权限
- ✅ 符号回归分析
- ✅ 蒙特卡罗分析
- ✅ 数据管理
- ✅ 用户管理
- ✅ 系统设置

#### 普通用户权限
- ✅ 符号回归分析
- ✅ 蒙特卡罗分析
- ❌ 数据管理
- ❌ 用户管理
- ✅ 系统设置

## 技术实现

### 后端技术栈
- **Flask** - Web框架
- **Flask-CORS** - 跨域支持
- **Session** - 会话管理
- **SHA256** - 密码哈希
- **JSON** - 数据存储

### 前端技术栈
- **原生JavaScript** - 核心逻辑
- **Fetch API** - HTTP请求
- **CSS变量** - 主题管理
- **模块化设计** - 代码组织

### 安全特性
- **密码哈希**：使用SHA256加密存储
- **会话管理**：安全的会话机制
- **权限验证**：API级别的权限控制
- **CORS配置**：安全的跨域设置

## 测试方法

### 1. API测试
```bash
# 检查管理员状态
curl -X GET http://127.0.0.1:5000/api/auth/check-admin

# 登录测试
curl -X POST http://127.0.0.1:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}' \
  -c cookies.txt

# 获取用户列表
curl -X GET http://127.0.0.1:5000/api/auth/users -b cookies.txt
```

### 2. 前端测试
访问 `http://localhost:3000/test_login.html` 进行功能测试

## 文件结构

```
tcm-homogenizer/
├── backend/
│   ├── api/
│   │   ├── auth.py          # 认证API
│   │   ├── app.py           # Flask应用
│   │   └── routes.py        # 其他API
│   ├── users.json           # 用户数据
│   ├── admin.json           # 管理员状态
│   └── main.py              # 后端入口
├── frontend/
│   ├── scripts/
│   │   ├── auth.js          # 认证模块
│   │   └── renderer.js      # 主应用
│   ├── styles/
│   │   └── main.css         # 深色主题
│   ├── index.html           # 主页面
│   └── test_login.html      # 测试页面
└── 登录功能使用说明.md       # 本文档
```

## 注意事项

1. **首次启动**：系统会自动检测是否需要创建管理员账号
2. **密码安全**：建议使用强密码，系统会自动哈希存储
3. **会话管理**：登录状态会自动维护，无需重复登录
4. **权限控制**：普通用户无法访问管理功能
5. **数据持久化**：用户数据保存在JSON文件中

## 开发计划

- [x] 基础登录功能
- [x] 用户管理功能
- [x] 权限控制系统
- [x] 深色主题UI
- [ ] 用户编辑功能
- [ ] 密码重置功能
- [ ] 用户活动日志
- [ ] 更高级的权限管理

## 联系方式

如有问题或建议，请联系开发团队。 